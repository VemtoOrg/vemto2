<?php

<% const camelCase = this.require('camelCase') %>

namespace App\Models;

use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;

class <$ this.model.name $> extends Model 
{
    use HasFactory;

    <% if(this.model.tableNameIsDifferentFromDefault()) { %>
    protected $table = '<$ this.model.table.name $>';
    <% } %>

    <% if(this.model.ownRelationships.length) { %>
        <# Relationships #>
        <% for (let relationship of this.model.ownRelationships) { %>
            <# Belongs To #>
            <% if(relationship.type == "BelongsTo") { %>
            public function <$ relationship.name $>() 
            {
                return $this->belongsTo(<$ relationship.relatedModel.name $>::class
                <# Check if foreign key or parent key are different #>
                <up if(relationship.getServiceFromType().hasDifferentForeignOrParentKey()) { up>
                , '<$ relationship.foreignKeyName $>'
                <up } up>
                <# --- #>
                <up if(relationship.getServiceFromType().hasDifferentParentKey()) { up>
                , '<$ relationship.parentKey.name $>'
                <up } up>);
            }

            <% } %>
            <# Has Many #>
            <% if(relationship.type == "HasMany") { %>
            public function <$ relationship.name $>() 
            {
                return $this->hasMany(<$ relationship.relatedModel.name $>::class
                <# Check if foreign key or parent key are different #>
                <up if(relationship.getServiceFromType().hasDifferentForeignOrParentKey()) { up>
                , '<$ relationship.foreignKeyName $>'
                <up } up>
                <# --- #>
                <up if(relationship.getServiceFromType().hasDifferentParentKey()) { up>
                , '<$ relationship.parentKey.name $>'
                <up } up>);
            }

            <% } %>
            <# Has One #>
            <% if(relationship.type == "HasOne") { %>
            public function <$ relationship.name $>() 
            {
                return $this->hasOne(<$ relationship.relatedModel.name $>::class
                <# Check if foreign key or parent key are different #>
                <up if(relationship.getServiceFromType().hasDifferentForeignOrParentKey()) { up>
                , '<$ relationship.foreignKeyName $>'
                <up } up>
                <# --- #>
                <up if(relationship.getServiceFromType().hasDifferentParentKey()) { up>
                , '<$ relationship.parentKey.name $>'
                <up } up>);
            }

            <% } %>
            <# Many To Many #>
            <% if(relationship.isManyToMany()) { %>
                public function <$ relationship.name $>() 
                {
                    return $this->belongsToMany(<$ relationship.relatedModel.name $>::class
                    <# Needs to add the pivot table if localKey or foreignKey are not default #>
                    <up if(relationship.getServiceFromType().needsToAddPivotToModelTemplate()) { up>
                    , '<$ relationship.pivot.name $>'
                    <up } up>
                    <# --- #>
                    <up if(relationship.getServiceFromType().hasDifferentForeignOrRelatedPivotKeys()) { up>
                    , '<$ relationship.foreignPivotKey.name $>'
                    <up } up>
                    <# --- #>
                    <up if(relationship.getServiceFromType().hasDifferentRelatedPivot()) { up>
                    , '<$ relationship.relatedPivotKey.name $>'
                    <up } up>);
                }

            <% } %>
            <# Morphs #>
            <% if(relationship.isMorph()) { %>
                public function <$ relationship.name $>() 
                {
                    return $this-><$ relationship.getTypeCamelCase() $>(<$ relationship.relatedModel.name $>::class, '<$ relationship.morphToName $>');
                }

            <% } %>
            <# Has Many Through #>
            <% if(relationship.isThrough()) { %>
                public function <$ relationship.name $>() 
                {
                    return $this-><$ relationship.getTypeCamelCase() $>(<$ relationship.relatedModel.name $>::class, <$ relationship.through.name $>::class
                    <up if(relationship.getServiceFromType().needsToAddFirstKeyNameToModelTemplate()) { up>
                    , '<$ relationship.firstKeyName $>'
                    <up } up>
                    <up if(relationship.getServiceFromType().hasDifferentSecondKeyName()) { up>
                    , '<$ relationship.secondKeyName $>'
                    <up } up>);
                }

            <% } %>
        <% } %>
    <% } %>
    
    <% if(this.model.relatedRelationships.length) { %>
        <# Basic Morph Inverse Relationships #>
        <% for(let relationship of this.model.getCommonMorphInverseRelationships()) { %>
            public function <$ relationship.morphToName $>() 
            {
                return $this->morphTo();
            }

        <% } %>

        <# MorphedByMany Relationships #>
        <% for(let relationship of this.model.getMorphedToManyRelatedRelationships()) { %>
            public function <$ camelCase(relationship.model.plural) $>() 
            {
                return $this->morphedByMany(<$ relationship.model.name $>::class, '<$ relationship.morphToName $>');
            }

        <% } %>
    <% } %>
}